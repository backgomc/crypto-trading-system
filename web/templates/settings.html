{% extends "base.html" %}

{% block title %}설정 - 자동매매{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
            <i class="bi bi-gear me-2"></i>설정
        </h2>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" onclick="resetSettings()">
                <i class="bi bi-arrow-clockwise me-1"></i>기본값 복원
            </button>
            <button class="btn btn-primary" onclick="saveSettings()">
                <i class="bi bi-check-lg me-1"></i>설정 저장
            </button>
        </div>
    </div>

    <div class="row">
        <!-- 좌측: 설정 폼들 -->
        <div class="col-lg-8">
            <!-- 기본 매매 설정 -->
            <div class="card bg-dark border-secondary shadow-sm mb-4">
                <div class="card-header bg-secondary">
                    <h5 class="mb-0">
                        <i class="bi bi-graph-up me-2"></i>기본 매매 설정
                    </h5>
                </div>
                <div class="card-body">
                    <form id="tradingForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">매매 모드</label>
                                <select class="form-select" id="tradingMode">
                                    <option value="demo" selected>📊 데모 매매</option>
                                    <option value="real">💰 실제 매매</option>
                                </select>
                                <div class="form-text">데모 모드에서는 가상 자금으로 매매가 진행됩니다</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">가상 잔고 (USDT)</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="virtualBalance" value="10000" min="1000" max="1000000">
                                    <span class="input-group-text">USDT</span>
                                </div>
                                <div class="form-text">데모 모드에서 사용할 가상 자금</div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">초기 포지션 크기</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="initialPosition" value="0.05" step="0.001" min="0.001" max="1">
                                    <span class="input-group-text">BTC</span>
                                </div>
                                <div class="form-text">첫 매매 시 진입할 포지션 크기</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">조정 크기</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="adjustmentSize" value="0.01" step="0.001" min="0.001" max="0.1">
                                    <span class="input-group-text">BTC</span>
                                </div>
                                <div class="form-text">추가 매매 시 조정할 포지션 크기</div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">기본 임계값</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="baseThreshold" value="1000" min="100" max="10000">
                                    <span class="input-group-text">USDT</span>
                                </div>
                                <div class="form-text">매매 신호를 발생시킬 가격 변동 기준</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">연속 신호 기준</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="consecutiveThreshold" value="4" min="2" max="10">
                                    <span class="input-group-text">회</span>
                                </div>
                                <div class="form-text">연속 신호 후 대응 매매를 실행할 기준</div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- AI 설정 -->
            <div class="card bg-dark border-secondary shadow-sm mb-4">
                <div class="card-header bg-secondary">
                    <h5 class="mb-0">
                        <i class="bi bi-brain me-2"></i>AI 모델 설정
                    </h5>
                </div>
                <div class="card-body">
                    <form id="aiForm">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableAI" checked>
                                    <label class="form-check-label fw-medium" for="enableAI">
                                        AI 모델 사용
                                    </label>
                                </div>
                                <div class="form-text">AI 기반 매매 신호 사용 여부</div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="adaptiveThreshold" checked>
                                    <label class="form-check-label fw-medium" for="adaptiveThreshold">
                                        적응형 임계값
                                    </label>
                                </div>
                                <div class="form-text">시장 변동성에 따른 임계값 자동 조정</div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">변동성 윈도우</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="volatilityWindow" value="20" min="5" max="100">
                                    <span class="input-group-text">일</span>
                                </div>
                                <div class="form-text">변동성 계산에 사용할 기간</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">재훈련 간격</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="retrainInterval" value="24" min="1" max="168">
                                    <span class="input-group-text">시간</span>
                                </div>
                                <div class="form-text">AI 모델 재훈련 주기</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">AI 학습 기간</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="trainingDays" value="365" min="30" max="1095">
                                    <span class="input-group-text">일</span>
                                </div>
                                <div class="form-text">AI 모델 학습에 사용할 데이터 기간</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">신뢰도 임계값</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="confidenceThreshold" value="0.7" step="0.1" min="0.5" max="1.0">
                                    <span class="input-group-text">%</span>
                                </div>
                                <div class="form-text">AI 신호를 적용할 최소 신뢰도</div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 알림 설정 -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-bell me-2"></i>알림 설정
                    </h5>
                </div>
                <div class="card-body">
                    <form id="notificationForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableTelegram" checked>
                                    <label class="form-check-label fw-medium" for="enableTelegram">
                                        텔레그램 알림
                                    </label>
                                </div>
                                <div class="form-text">매매 및 시스템 상태 알림</div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableEmail">
                                    <label class="form-check-label fw-medium" for="enableEmail">
                                        이메일 알림
                                    </label>
                                </div>
                                <div class="form-text">중요 이벤트 이메일 알림</div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">알림 빈도</label>
                                <select class="form-select" id="notificationFrequency">
                                    <option value="all" selected>모든 거래</option>
                                    <option value="important">중요 이벤트만</option>
                                    <option value="summary">일일 요약</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">수익 알림 기준</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="profitNotification" value="1000" min="100">
                                    <span class="input-group-text">원</span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 우측: 상태 및 정보 -->
        <div class="col-lg-4">
            <!-- 현재 상태 -->
            <div class="card bg-dark border-secondary shadow-sm mb-4">
                <div class="card-header bg-secondary">
                    <h5 class="mb-0">
                        <i class="bi bi-info-circle me-2"></i>현재 상태
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>설정 상태</span>
                        <span class="badge bg-success">저장됨</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>마지막 저장</span>
                        <span class="text-muted" id="lastSaved">방금 전</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>설정 파일</span>
                        <span class="text-success">
                            <i class="bi bi-check-circle"></i>
                        </span>
                    </div>
                    
                    <hr>
                    
                    <h6 class="mb-3">빠른 설정</h6>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary btn-sm" onclick="applyConservative()">
                            <i class="bi bi-shield me-1"></i>보수적 설정
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="applyBalanced()">
                            <i class="bi bi-bar-chart me-1"></i>균형 설정
                        </button>
                        <button class="btn btn-outline-danger btn-sm" onclick="applyAggressive()">
                            <i class="bi bi-lightning me-1"></i>공격적 설정
                        </button>
                    </div>
                </div>
            </div>

            <!-- 설정 도움말 -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-question-circle me-2"></i>설정 도움말
                    </h5>
                </div>
                <div class="card-body">
                    <div class="accordion accordion-flush" id="helpAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help1">
                                    매매 모드
                                </button>
                            </h2>
                            <div id="help1" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <small>데모 모드는 실제 자금 없이 가상으로 매매를 테스트할 수 있습니다. 실제 매매 전에 충분한 테스트를 권장합니다.</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help2">
                                    AI 설정
                                </button>
                            </h2>
                            <div id="help2" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                <div class="accordion-body">
                                    <small>AI 모델은 과거 데이터를 학습하여 매매 신호를 생성합니다. 적응형 임계값은 시장 변동성에 따라 자동으로 조정됩니다.</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // 설정 저장
    function saveSettings() {
        // TODO: API 연동
        alert('설정이 저장되었습니다.');
        document.getElementById('lastSaved').textContent = '방금 전';
    }
    
    // 기본값 복원
    function resetSettings() {
        if (confirm('모든 설정을 기본값으로 복원하시겠습니까?')) {
            // 기본값 설정
            document.getElementById('tradingMode').value = 'demo';
            document.getElementById('virtualBalance').value = 10000;
            document.getElementById('initialPosition').value = 0.05;
            document.getElementById('adjustmentSize').value = 0.01;
            document.getElementById('baseThreshold').value = 1000;
            document.getElementById('consecutiveThreshold').value = 4;
            document.getElementById('enableAI').checked = true;
            document.getElementById('adaptiveThreshold').checked = true;
            document.getElementById('volatilityWindow').value = 20;
            document.getElementById('retrainInterval').value = 24;
            
            alert('기본값으로 복원되었습니다.');
        }
    }
    
    // 빠른 설정 함수들
    function applyConservative() {
        document.getElementById('initialPosition').value = 0.03;
        document.getElementById('adjustmentSize').value = 0.005;
        document.getElementById('baseThreshold').value = 1500;
        alert('보수적 설정이 적용되었습니다.');
    }
    
    function applyBalanced() {
        document.getElementById('initialPosition').value = 0.05;
        document.getElementById('adjustmentSize').value = 0.01;
        document.getElementById('baseThreshold').value = 1000;
        alert('균형 설정이 적용되었습니다.');
    }
    
    function applyAggressive() {
        document.getElementById('initialPosition').value = 0.08;
        document.getElementById('adjustmentSize').value = 0.02;
        document.getElementById('baseThreshold').value = 500;
        alert('공격적 설정이 적용되었습니다.');
    }
    
    // AI 활성화/비활성화에 따른 UI 업데이트
    document.getElementById('enableAI').addEventListener('change', function() {
        const aiInputs = document.querySelectorAll('#volatilityWindow, #retrainInterval, #trainingDays, #confidenceThreshold');
        aiInputs.forEach(input => {
            input.disabled = !this.checked;
        });
        document.getElementById('adaptiveThreshold').disabled = !this.checked;
    });
</script>
{% endblock %}