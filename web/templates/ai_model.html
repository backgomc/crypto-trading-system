<!-- 파일 경로: web/templates/ai_model.html -->
<!-- 코드명: AI 모델 관리 페이지 템플릿 (개선된 툴팁 버전) -->

{% extends "base.html" %}

{% block title %}NHBot - AI 모델 관리{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/ai_model.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4 page-header">
        <h2 class="mb-0">
            <i class="bi bi-cpu me-2"></i>AI 모델 관리
        </h2>
        <div class="current-time">
            <i class="bi bi-clock me-1"></i>
            <span id="currentTime"></span>
        </div>
    </div>

    <div class="row">
        <!-- 좌측: 학습 설정 및 실행 -->
        <div class="col-lg-8 mb-4">
            <!-- 학습 지표 선택 (개선된 UI) -->
            <div class="card main-card mb-4">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-graph-up me-2"></i>학습 지표 선택
                        <span class="badge bg-primary ms-2" id="totalSelectedCount">0개 선택</span>
                    </h5>
                </div>
                <div class="card-body">
                    <!-- 핵심 지표 섹션 (선택 가능하게 변경) -->
                    <div class="indicator-section mb-4">
                        <h6 class="section-title">
                            <i class="bi bi-star-fill text-warning me-2"></i>핵심 지표
                            <small class="text-muted ms-2">(원웨이 장 대응 특화)</small>
                            <span class="badge bg-info float-end" id="essentialIndicatorCount">0개 선택</span>
                        </h6>
                        <p class="section-description text-muted small mb-3">
                            <i class="bi bi-info-circle me-1"></i>
                            원웨이 장 감지와 추세 전환점 포착에 직접적으로 필요한 핵심 지표들입니다. AI 모델이 매매 여부를 결정하는 가장 중요한 근거가 됩니다.
                        </p>
                        <div class="essential-indicators-grid">
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📊 가격 데이터 (OHLCV)&#10;&#10;용도: 모든 분석의 기초 데이터&#10;계산: 종가, 변화율%, 고저범위&#10;활용: 가격 움직임 자체가 가장 순수한 시장 신호">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_price" checked class="form-check-input indicator-checkbox" data-indicator="price">
                                    <label class="indicator-name" for="indicator_price">가격 데이터</label>
                                    <span class="indicator-badge">3</span>
                                </div>
                                <small class="indicator-desc">종가, 변화율, 고저범위</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📈 MACD&#10;&#10;용도: 추세 전환점 포착&#10;계산: 12일-26일 이평선 차이&#10;신호: 시그널선 상향돌파=매수, 하향돌파=매도&#10;⭐ NHBot 핵심: 리밸런싱 타이밍 결정">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_macd" checked class="form-check-input indicator-checkbox" data-indicator="macd">
                                    <label class="indicator-name" for="indicator_macd">MACD</label>
                                    <span class="indicator-badge">3</span>
                                </div>
                                <small class="indicator-desc">MACD, 시그널, 히스토그램</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔥 RSI (상대강도지수)&#10;&#10;용도: 과매수/과매도 판단&#10;계산: 14일간 상승/하락 비율&#10;신호: 70이상=과매수(하락가능), 30이하=과매도(상승가능)&#10;활용: 극단값(80↑,20↓)은 강한 추세 의미">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_rsi" checked class="form-check-input indicator-checkbox" data-indicator="rsi">
                                    <label class="indicator-name" for="indicator_rsi">RSI</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">14일 RSI</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📊 볼린저밴드&#10;&#10;용도: 변동성 채널 분석&#10;계산: 20일 이평 ± 2×표준편차&#10;신호: 상단터치=과매수, 하단터치=과매도&#10;활용: 밴드폭 좁음=변동성↓, 넓음=변동성↑">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_bb" checked class="form-check-input indicator-checkbox" data-indicator="bb">
                                    <label class="indicator-name" for="indicator_bb">볼린저밴드</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">위치, 폭</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📏 ATR (평균 실제 범위)&#10;&#10;용도: 시장 변동성 측정&#10;계산: 14일 평균 가격 범위&#10;활용: ATR↑=변동성 큼, ATR↓=변동성 작음&#10;손절/익절 설정 기준으로 사용">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_atr" checked class="form-check-input indicator-checkbox" data-indicator="atr">
                                    <label class="indicator-name" for="indicator_atr">ATR</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">평균 실제 범위</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📊 거래량 분석&#10;&#10;용도: 매수/매도 압력 파악&#10;측정: 거래량 비율, CVD(누적델타)&#10;신호: 거래량↑+가격↑=강세, 거래량↓+가격↑=약세&#10;CVD상승=매수우세, CVD하락=매도우세">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_volume" checked class="form-check-input indicator-checkbox" data-indicator="volume">
                                    <label class="indicator-name" for="indicator_volume">거래량</label>
                                    <span class="indicator-badge">3</span>
                                </div>
                                <small class="indicator-desc">비율, CVD, CVD 기울기</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🎯 ADX (평균 방향성 지수)&#10;&#10;용도: 추세 강도 측정&#10;계산: 방향성 움직임의 평균&#10;해석: 25이상=추세강함, 25이하=횡보&#10;주의: 방향X, 강도만 표시">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_adx" checked class="form-check-input indicator-checkbox" data-indicator="adx">
                                    <label class="indicator-name" for="indicator_adx">ADX</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">추세강도, 기울기</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔄 Aroon 오실레이터&#10;&#10;용도: 추세 시작 조기 감지&#10;계산: 최고/최저가 경과 시간&#10;신호: 상승선>하락선=상승추세, 반대=하락추세&#10;활용: 교차점=추세 전환 신호">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_aroon" checked class="form-check-input indicator-checkbox" data-indicator="aroon">
                                    <label class="indicator-name" for="indicator_aroon">Aroon</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">추세 전환 타이밍</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔢 연속 카운터&#10;&#10;용도: 한 방향 연속 움직임 추적&#10;측정: 연속 상승/하락 횟수&#10;신호: 5회이상 연속=강한 추세&#10;활용: 원웨이 장 감지 기초 데이터">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_consecutive" checked class="form-check-input indicator-checkbox" data-indicator="consecutive">
                                    <label class="indicator-name" for="indicator_consecutive">연속 카운터</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">연속 상승/하락</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="⏰ 다중 시간대 분석&#10;&#10;용도: 시간대별 추세 일치도 확인&#10;측정: 1시간/4시간봉 추세&#10;신호: 모든 시간대 일치=강한 신호&#10;활용: 단기/장기 추세 동시 파악">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_trend" checked class="form-check-input indicator-checkbox" data-indicator="trend">
                                    <label class="indicator-name" for="indicator_trend">다중 시간대</label>
                                    <span class="indicator-badge">4</span>
                                </div>
                                <small class="indicator-desc">1H, 4H 추세, 정렬도</small>
                            </div>
                            <!-- 🆕 핵심 지표로 이동된 중요 지표들 -->
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="⭐ HH/LL 카운터&#10;&#10;용도: 고점/저점 갱신 추적&#10;측정: Higher High, Lower Low 횟수&#10;신호: 연속 5회 HH=강한 상승, 5회 LL=강한 하락&#10;🔥 원웨이 장 핵심 지표">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_hhll" checked class="form-check-input indicator-checkbox" data-indicator="hhll">
                                    <label class="indicator-name" for="indicator_hhll">HH/LL 카운터 ⭐</label>
                                    <span class="indicator-badge">3</span>
                                </div>
                                <small class="indicator-desc">고점/저점 갱신 추적</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="⭐ Z-score&#10;&#10;용도: 평균 대비 현재 위치&#10;계산: (현재가-평균)÷표준편차&#10;신호: ±2이상=극단값(평균회귀 예상)&#10;활용: ±3이상=99.7% 확률로 반전">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_zscore" checked class="form-check-input indicator-checkbox" data-indicator="zscore">
                                    <label class="indicator-name" for="indicator_zscore">Z-score ⭐</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">평균 회귀 지표</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="⭐ Market Structure&#10;&#10;용도: 시장 구조 돌파 감지&#10;측정: 주요 고점/저점 돌파&#10;신호: 구조 돌파=추세 전환&#10;활용: 가짜 돌파 필터링">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_market_structure" checked class="form-check-input indicator-checkbox" data-indicator="market_structure">
                                    <label class="indicator-name" for="indicator_market_structure">Market Structure ⭐</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">시장 구조 돌파</small>
                            </div>
                            <div class="indicator-card essential" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="⭐ 추세 강도 점수&#10;&#10;용도: 종합 추세 강도 점수화&#10;계산: ADX+연속카운터+거래량 종합&#10;점수: ±80이상=매우 강한 추세, ±50~80=추세, -50~+50=횡보&#10;🔥 AI 최종 의사결정 핵심">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_trend_strength" checked class="form-check-input indicator-checkbox" data-indicator="trend_strength">
                                    <label class="indicator-name" for="indicator_trend_strength">추세 강도 점수 ⭐</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">종합 추세 점수</small>
                            </div>
                        </div>
                    </div>

                    <!-- 선택적 지표 섹션 -->
                    <div class="indicator-section mb-4">
                        <h6 class="section-title">
                            <i class="bi bi-plus-circle me-2"></i>선택적 지표
                            <small class="text-muted ms-2">(필요시 추가)</small>
                            <span class="badge bg-info float-end" id="optionalIndicatorCount">0개 선택</span>
                        </h6>
                        <p class="section-description text-muted small mb-3">
                            <i class="bi bi-info-circle me-1"></i>
                            기본적이고 널리 사용되는 보조 지표들입니다. 핵심 지표를 보완하여 더 정밀한 분석이 가능하지만, 다른 지표와 중복되는 정보가 있을 수 있습니다.
                        </p>
                        <div class="optional-indicators-grid">
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📈 SMA (단순이동평균)&#10;&#10;용도: 추세 방향 파악&#10;계산: N일간 종가 평균&#10;활용: 가격>SMA=상승추세, 가격<SMA=하락추세">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_sma" class="form-check-input indicator-checkbox" data-indicator="sma">
                                    <label class="indicator-name" for="indicator_sma">SMA</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">단순이동평균</small>
                            </div>
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📈 EMA (지수이동평균)&#10;&#10;용도: 빠른 추세 반응&#10;계산: 최근 가격에 가중치&#10;활용: SMA보다 빠른 신호, 단기 추세 포착">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_ema" class="form-check-input indicator-checkbox" data-indicator="ema">
                                    <label class="indicator-name" for="indicator_ema">EMA</label>
                                    <span class="indicator-badge">3</span>
                                </div>
                                <small class="indicator-desc">지수이동평균</small>
                            </div>
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📊 스토캐스틱&#10;&#10;용도: 과매수/과매도 판단&#10;계산: 현재가의 고저 범위 위치&#10;신호: 80이상=과매수, 20이하=과매도&#10;K선과 D선 교차=매매신호">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_stoch" class="form-check-input indicator-checkbox" data-indicator="stoch">
                                    <label class="indicator-name" for="indicator_stoch">스토캐스틱</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">K%, D%</small>
                            </div>
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📊 Williams %R&#10;&#10;용도: 모멘텀 측정&#10;계산: 스토캐스틱의 반대&#10;신호: -20이상=과매수, -80이하=과매도&#10;활용: 빠른 전환점 감지">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_williams" class="form-check-input indicator-checkbox" data-indicator="williams">
                                    <label class="indicator-name" for="indicator_williams">Williams %R</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">모멘텀 지표</small>
                            </div>
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="💰 MFI (자금흐름지표)&#10;&#10;용도: 거래량 포함 RSI&#10;계산: 가격×거래량 기반&#10;신호: 80이상=과매수, 20이하=과매도&#10;활용: RSI보다 정확한 신호">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_mfi" class="form-check-input indicator-checkbox" data-indicator="mfi">
                                    <label class="indicator-name" for="indicator_mfi">MFI</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">자금흐름지표</small>
                            </div>
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="⚖️ VWAP&#10;&#10;용도: 기관 평균 매수가&#10;계산: 거래량 가중 평균가&#10;활용: 가격>VWAP=강세, 가격<VWAP=약세&#10;데이트레이딩 기준선">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_vwap" class="form-check-input indicator-checkbox" data-indicator="vwap">
                                    <label class="indicator-name" for="indicator_vwap">VWAP</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">거래량가중평균</small>
                            </div>
                            <div class="indicator-card optional" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="📉 변동성&#10;&#10;용도: 시장 불안정성 측정&#10;계산: 20일 표준편차&#10;활용: 높음=큰 가격변동, 낮음=안정적&#10;포지션 크기 조절 기준">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_volatility" class="form-check-input indicator-checkbox" data-indicator="volatility">
                                    <label class="indicator-name" for="indicator_volatility">변동성</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">20일 변동성</small>
                            </div>
                        </div>
                    </div>

                    <!-- 🆕 고급 지표 섹션 (새로 추가) -->
                    <div class="indicator-section">
                        <h6 class="section-title">
                            <i class="bi bi-lightning-fill text-danger me-2"></i>고급 지표
                            <small class="text-muted ms-2">(고급 전략용)</small>
                            <span class="badge bg-info float-end" id="advancedIndicatorCount">0개 선택</span>
                        </h6>
                        <p class="section-description text-muted small mb-3">
                            <i class="bi bi-info-circle me-1"></i>
                            전문 트레이더들이 사용하는 복잡한 계산 기반 지표들입니다. 더 많은 데이터와 연산이 필요하지만, 일반 지표가 놓치는 특수한 시장 상황을 포착할 수 있습니다.
                        </p>
                        <div class="advanced-indicators-grid">
                            <!-- 채널 지표 -->
                            <div class="indicator-card advanced" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔴 Keltner Channel&#10;&#10;용도: ATR 기반 동적 채널&#10;계산: EMA ± (ATR×배수)&#10;활용: 볼린저밴드보다 안정적&#10;브레이크아웃 시 강한 추세 신호">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_keltner" class="form-check-input indicator-checkbox" data-indicator="keltner">
                                    <label class="indicator-name" for="indicator_keltner">Keltner Channel</label>
                                    <span class="indicator-badge">4</span>
                                </div>
                                <small class="indicator-desc">볼린저밴드 대안</small>
                            </div>
                            <div class="indicator-card advanced" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔴 Donchian Channel&#10;&#10;용도: N일 최고/최저가 채널&#10;계산: 20일 고점/저점 연결&#10;활용: 터틀 트레이딩 핵심&#10;돌파 시 추세 추종 진입">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_donchian" class="form-check-input indicator-checkbox" data-indicator="donchian">
                                    <label class="indicator-name" for="indicator_donchian">Donchian Channel</label>
                                    <span class="indicator-badge">4</span>
                                </div>
                                <small class="indicator-desc">고점/저점 돌파</small>
                            </div>
                            
                            <!-- 거래량 고급 지표 -->
                            <div class="indicator-card advanced" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔴 VPOC (Volume Point of Control)&#10;&#10;용도: 최대 거래량 가격대&#10;측정: 가격별 거래량 누적&#10;활용: 강력한 지지/저항선&#10;이탈 시 큰 움직임 예상">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_vpoc" class="form-check-input indicator-checkbox" data-indicator="vpoc">
                                    <label class="indicator-name" for="indicator_vpoc">VPOC</label>
                                    <span class="indicator-badge">2</span>
                                </div>
                                <small class="indicator-desc">가격대별 거래량</small>
                            </div>
                            <div class="indicator-card advanced" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔴 Order Flow Imbalance&#10;&#10;용도: 매수/매도 불균형&#10;측정: 주문량 차이 분석&#10;신호: 큰 불균형=방향성 힌트&#10;단기 스캘핑에 유용">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_order_flow" class="form-check-input indicator-checkbox" data-indicator="order_flow">
                                    <label class="indicator-name" for="indicator_order_flow">Order Flow</label>
                                    <span class="indicator-badge">1</span>
                                </div>
                                <small class="indicator-desc">주문 플로우 불균형</small>
                            </div>
                            
                            <!-- 가격 구조 지표 -->
                            <div class="indicator-card advanced" data-bs-toggle="tooltip" data-bs-placement="top" 
                                 title="🔴 Pivot Points&#10;&#10;용도: 지지/저항 레벨&#10;계산: (전일 고+저+종)/3&#10;레벨: R1,R2,S1,S2 등&#10;데이트레이딩 필수 지표">
                                <div class="indicator-header">
                                    <input type="checkbox" id="indicator_pivot" class="form-check-input indicator-checkbox" data-indicator="pivot">
                                    <label class="indicator-name" for="indicator_pivot">Pivot Points</label>
                                    <span class="indicator-badge">4</span>
                                </div>
                                <small class="indicator-desc">피봇 지지/저항</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 학습 파라미터 설정 -->
            <div class="card main-card mb-4">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-sliders me-2"></i>학습 파라미터 설정
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">학습 데이터 기간</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="trainingDays" value="365" min="30" max="1825">
                                <span class="input-group-text">일</span>
                            </div>
                            <div class="form-text">과거 몇 일간의 데이터로 학습할지 설정</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">에폭 (Epochs)</label>
                            <input type="number" class="form-control" id="epochs" value="100" min="10" max="1000">
                            <div class="form-text">모델 학습 반복 횟수</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">배치 크기 (Batch Size)</label>
                            <input type="number" class="form-control" id="batchSize" value="32" min="8" max="128">
                            <div class="form-text">한 번에 처리할 데이터 개수</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">학습률 (Learning Rate)</label>
                            <input type="number" class="form-control" id="learningRate" value="0.001" min="0.0001" max="0.1" step="0.0001">
                            <div class="form-text">모델 가중치 업데이트 속도</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">시퀀스 길이</label>
                            <input type="number" class="form-control" id="sequenceLength" value="60" min="10" max="200">
                            <div class="form-text">예측에 사용할 과거 데이터 개수 (분)</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label fw-medium">검증 비율</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="validationSplit" value="20" min="10" max="30">
                                <span class="input-group-text">%</span>
                            </div>
                            <div class="form-text">검증용으로 사용할 데이터 비율</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 학습 실행 및 모니터링 -->
            <div class="card main-card">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-play-circle me-2"></i>학습 실행 및 모니터링
                    </h5>
                </div>
                <div class="card-body">
                    <!-- 학습 제어 버튼 -->
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="d-flex gap-2">
                                <button class="btn btn-success" id="startTrainingBtn">
                                    <i class="bi bi-play-fill me-1"></i>학습 시작
                                </button>
                                <button class="btn btn-danger" id="stopTrainingBtn" disabled>
                                    <i class="bi bi-stop-fill me-1"></i>학습 중지
                                </button>
                                <button class="btn btn-outline-secondary" id="resetParametersBtn">
                                    <i class="bi bi-arrow-clockwise me-1"></i>기본값 복원
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="training-status">
                                <span class="badge bg-secondary" id="trainingStatus">대기 중</span>
                            </div>
                        </div>
                    </div>

                    <!-- 학습 진행률 -->
                    <div id="trainingProgress" style="display: none;">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-medium">전체 진행률</label>
                                <div class="progress mb-2" style="height: 25px;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                         id="overallProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="progressText">0/100 에폭</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-medium">현재 에폭 진행률</label>
                                <div class="progress mb-2" style="height: 25px;">
                                    <div class="progress-bar bg-info progress-bar-striped progress-bar-animated" 
                                         id="epochProgress" role="progressbar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="epochText">0/100 배치</small>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="training-info">
                                    <div class="info-item">
                                        <span class="label">시작 시간:</span>
                                        <span id="startTime">-</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">경과 시간:</span>
                                        <span id="elapsedTime">00:00:00</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">예상 완료:</span>
                                        <span id="estimatedTime">-</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="training-metrics">
                                    <div class="metric-item">
                                        <span class="label">Loss:</span>
                                        <span id="currentLoss" class="value">-</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="label">Accuracy:</span>
                                        <span id="currentAccuracy" class="value">-</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="label">Val Loss:</span>
                                        <span id="valLoss" class="value">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 우측: 모델 히스토리 및 관리 -->
        <div class="col-lg-4">
            <!-- 현재 활성 모델 -->
            <div class="card main-card mb-4">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-star me-2"></i>현재 활성 모델
                    </h5>
                </div>
                <div class="card-body">
                    <div class="active-model-info">
                        <div class="model-name">
                            <strong id="activeModelName">모델 없음</strong>
                        </div>
                        <div class="model-stats">
                            <div class="stat-item">
                                <span class="label">정확도:</span>
                                <span class="value text-success" id="activeModelAccuracy">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">학습일:</span>
                                <span class="value" id="activeModelDate">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">상태:</span>
                                <span id="activeModelBadge" class="badge bg-secondary">비활성</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 모델 히스토리 -->
            <div class="card main-card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-clock-history me-2"></i>모델 히스토리
                    </h5>
                    <button class="btn btn-outline-danger btn-sm" id="cleanupModelsBtn">
                        <i class="bi bi-trash me-1"></i>정리
                    </button>
                </div>
                <div class="card-body p-0">
                    <div class="model-list">
                        <!-- JavaScript로 동적 생성 -->
                    </div>
                </div>
            </div>

            <!-- 자동 학습 스케줄러 -->
            <div class="card main-card">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-calendar-event me-2"></i>자동 학습 스케줄러
                    </h5>
                </div>
                <div class="card-body">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="autoRetraining" checked>
                        <label class="form-check-label fw-medium" for="autoRetraining">
                            자동 재학습 활성화
                        </label>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-medium">재학습 간격</label>
                        <select class="form-select" id="retrainingInterval">
                            <option value="86400">매일 (24시간)</option>
                            <option value="172800">2일마다</option>
                            <option value="604800">매주 (7일)</option>
                            <option value="1209600">2주마다</option>
                        </select>
                    </div>
                    
                    <div class="next-training">
                        <small class="text-muted">다음 자동 학습: </small>
                        <small id="nextTraining">-</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 토스트 컨테이너 -->
<div id="toastContainer"></div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/common.js') }}"></script>
<script src="{{ url_for('static', filename='js/ai_model.js') }}"></script>
{% endblock %}