<!-- web/templates/dashboard.html -->
{% extends "base.html" %}

{% block title %}ÎåÄÏãúÎ≥¥Îìú - ÏûêÎèôÎß§Îß§{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
<style>
/* Ï∞®Ìä∏ Ïò§Î≤ÑÎ†àÏù¥ Ïä§ÌÉÄÏùº */
.chart-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 10;
}

.position-line {
    position: absolute;
    width: 100%;
    height: 2px;
    pointer-events: none;
    opacity: 0.8;
}

.position-line.long {
    background-color: #00ff00;
    box-shadow: 0 0 5px #00ff00;
}

.position-line.short {
    background-color: #ff0000;
    box-shadow: 0 0 5px #ff0000;
}

.position-label {
    position: absolute;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
    white-space: nowrap;
}

.trade-marker {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 12px;
    pointer-events: auto;
    cursor: pointer;
    animation: pulse 2s infinite;
}

.trade-marker.buy {
    background-color: #00ff00;
    color: black;
    border: 2px solid #00aa00;
}

.trade-marker.sell {
    background-color: #ff0000;
    color: white;
    border: 2px solid #aa0000;
}

.trade-tooltip {
    position: absolute;
    background: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 12px;
    white-space: nowrap;
    z-index: 100;
    display: none;
    border: 1px solid #444;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.chart-container {
    position: relative;
    height: 600px;
    width: 100%;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- ÌéòÏù¥ÏßÄ Ìó§Îçî -->
    <div class="d-flex justify-content-between align-items-center mb-4 page-header">
        <h2 class="mb-0">
            <i class="bi bi-speedometer2 me-2"></i>ÎåÄÏãúÎ≥¥Îìú
        </h2>
        <div class="current-time">
            <i class="bi bi-clock me-1"></i>
            <span id="currentTime"></span>
        </div>
    </div>

    <!-- ÏÉÅÌÉú Ïπ¥ÎìúÎì§ -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card status-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6>ÏãúÏä§ÌÖú ÏÉÅÌÉú</h6>
                            <h4 id="systemStatus" class="text-danger">Ï§ëÏßÄÎê®</h4>
                        </div>
                        <div class="card-icon text-danger">
                            <i class="bi bi-power" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card status-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6>Ï¥ù ÏûîÍ≥†</h6>
                            <h4 id="totalBalance" class="text-primary">10,000,000Ïõê</h4>
                        </div>
                        <div class="card-icon text-primary">
                            <i class="bi bi-wallet2" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card status-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6>Ïò§Îäò ÏàòÏùµ</h6>
                            <h4 id="todayProfit" class="text-success">+150,000Ïõê</h4>
                        </div>
                        <div class="card-icon text-success">
                            <i class="bi bi-graph-up-arrow" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card status-card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6>ÏàòÏùµÎ•†</h6>
                            <h4 id="profitRate" class="text-success">+1.5%</h4>
                        </div>
                        <div class="card-icon text-success">
                            <i class="bi bi-percent" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Ï¢åÏ∏°: Ï∞®Ìä∏ + Ï†úÏñ¥Ìåê -->
        <div class="col-lg-8 mb-4">
            <!-- Ï∞®Ìä∏ ÏòÅÏó≠ -->
            <div class="card main-card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="bi bi-graph-up me-2"></i>ÎπÑÌä∏ÏΩîÏù∏ Ï∞®Ìä∏
                    </h5>
                    <div class="chart-controls">
                        <select id="chartSymbol" class="form-select form-select-sm me-2" style="width: auto;" onchange="changeSymbol()">
                            <option value="BYBIT:BTCUSDT">BTC/USDT</option>
                            <option value="BYBIT:ETHUSDT">ETH/USDT</option>
                            <option value="BYBIT:ADAUSDT">ADA/USDT</option>
                            <option value="BYBIT:SOLUSDT">SOL/USDT</option>
                        </select>
                        <button id="toggleOverlay" class="btn btn-sm btn-outline-primary" onclick="toggleOverlay()">
                            <i class="bi bi-eye"></i> Ìè¨ÏßÄÏÖò ÌëúÏãú
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- TradingView Ï∞®Ìä∏ Ïª®ÌÖåÏù¥ÎÑà -->
                    <div class="chart-container">
                        <div class="tradingview-widget-container" style="height: 600px; width: 100%;">
                            <div id="tradingview_chart"></div>
                        </div>
                        
                        <!-- ÏûêÎèôÎß§Îß§ Ìè¨ÏßÄÏÖò Ïò§Î≤ÑÎ†àÏù¥ -->
                        <div id="chartOverlay" class="chart-overlay">
                            <!-- Î°± Ìè¨ÏßÄÏÖò ÌèâÎã®Í∞Ä ÎùºÏù∏ -->
                            <div id="longPositionLine" class="position-line long" style="top: 45%; display: none;">
                                <div class="position-label" style="right: 10px; top: -25px; background-color: #00aa00;">
                                    üü¢ Long Avg: $117,000
                                </div>
                            </div>
                            
                            <!-- Ïàè Ìè¨ÏßÄÏÖò ÌèâÎã®Í∞Ä ÎùºÏù∏ -->
                            <div id="shortPositionLine" class="position-line short" style="top: 35%; display: none;">
                                <div class="position-label" style="right: 10px; top: -25px; background-color: #aa0000;">
                                    üî¥ Short Avg: $119,500
                                </div>
                            </div>
                            
                            <!-- Îß§Îß§ ÎßàÏª§Îì§ -->
                            <div id="tradeMarkers">
                                <!-- Îß§Ïàò ÎßàÏª§ -->
                                <div class="trade-marker buy" style="left: 20%; top: 55%;" 
                                     data-tooltip="üü¢ Îß§Ïàò 0.01 BTC<br>$116,800<br>2025-07-23 14:30"
                                     onmouseover="showTooltip(this)" onmouseout="hideTooltip()">
                                    ‚Üë
                                </div>
                                
                                <!-- Îß§ÎèÑ ÎßàÏª§ -->
                                <div class="trade-marker sell" style="left: 40%; top: 25%;" 
                                     data-tooltip="üî¥ Îß§ÎèÑ 0.01 BTC<br>$119,200<br>2025-07-23 15:45"
                                     onmouseover="showTooltip(this)" onmouseout="hideTooltip()">
                                    ‚Üì
                                </div>
                                
                                <!-- Îß§Ïàò ÎßàÏª§ -->
                                <div class="trade-marker buy" style="left: 60%; top: 50%;" 
                                     data-tooltip="üü¢ Îß§Ïàò 0.015 BTC<br>$117,500<br>2025-07-23 16:15"
                                     onmouseover="showTooltip(this)" onmouseout="hideTooltip()">
                                    ‚Üë
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ìà¥ÌåÅ -->
                        <div id="tradeTooltip" class="trade-tooltip"></div>
                    </div>
                </div>
            </div>

            <!-- Ï†úÏñ¥ Î≤ÑÌäºÎì§ -->
            <div class="card main-card">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-gear me-2"></i>Ï†úÏñ¥Ìåê
                    </h5>
                </div>
                <div class="card-body control-buttons">
                    <div class="row g-3">
                        <div class="col-6 col-md-3">
                            <button class="btn btn-success w-100" onclick="startTrading()">
                                <i class="bi bi-play-fill me-1"></i>ÏãúÏûë
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn btn-danger w-100" onclick="stopTrading()">
                                <i class="bi bi-stop-fill me-1"></i>Ï§ëÎã®
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn btn-warning w-100" onclick="trainAI()">
                                <i class="bi bi-brain me-1"></i>AI ÌïôÏäµ
                            </button>
                        </div>
                        <div class="col-6 col-md-3">
                            <button class="btn btn-outline-danger w-100" onclick="emergencyStop()">
                                <i class="bi bi-exclamation-triangle me-1"></i>Í∏¥Í∏â Ï≤≠ÏÇ∞
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ïö∞Ï∏°: Ìè¨ÏßÄÏÖò Î∞è Ï†ïÎ≥¥ -->
        <div class="col-lg-4">
            <!-- Ìè¨ÏßÄÏÖò ÌòÑÌô© -->
            <div class="card main-card mb-4">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-pie-chart me-2"></i>Ìè¨ÏßÄÏÖò ÌòÑÌô©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center mb-3">
                        <div class="col-6">
                            <div class="position-box long-position">
                                <h6 class="text-success mb-1">Î°± Ìè¨ÏßÄÏÖò</h6>
                                <p id="longSize" class="mb-1">0.05 BTC</p>
                                <small id="longAvgPrice">@ $117,000</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="position-box short-position">
                                <h6 class="text-danger mb-1">Ïàè Ìè¨ÏßÄÏÖò</h6>
                                <p id="shortSize" class="mb-1">0.05 BTC</p>
                                <small id="shortAvgPrice">@ $119,500</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="total-pnl">
                        <h6>Ï¥ù ÎØ∏Ïã§ÌòÑ ÏÜêÏùµ</h6>
                        <h4 id="totalPnl">+$42,500</h4>
                        <small id="totalPnlPercent">+0.36%</small>
                    </div>
                </div>
            </div>

            <!-- AI ÏÉÅÌÉú -->
            <div class="card main-card mb-4">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-brain me-2"></i>AI Î™®Îç∏ ÏÉÅÌÉú
                    </h5>
                </div>
                <div class="card-body">
                    <div class="ai-status-item d-flex justify-content-between align-items-center">
                        <span>Î™®Îç∏ ÏÉÅÌÉú</span>
                        <span id="aiStatus" class="badge bg-warning">ÎåÄÍ∏∞Ï§ë</span>
                    </div>
                    <div class="ai-status-item d-flex justify-content-between align-items-center">
                        <span>ÎßàÏßÄÎßâ ÌïôÏäµ</span>
                        <span id="lastTraining" class="text-muted">2ÏãúÍ∞Ñ Ï†Ñ</span>
                    </div>
                    <div class="ai-status-item d-flex justify-content-between align-items-center">
                        <span>Ï†ïÌôïÎèÑ</span>
                        <span id="aiAccuracy" class="text-success">85.3%</span>
                    </div>
                    <div class="ai-progress mt-2">
                        <div id="aiProgressBar" class="progress-bar" style="width: 85.3%"></div>
                    </div>
                </div>
            </div>

            <!-- ÏµúÍ∑º Í±∞Îûò -->
            <div class="card main-card">
                <div class="card-header">
                    <h5>
                        <i class="bi bi-clock-history me-2"></i>ÏµúÍ∑º Í±∞Îûò
                    </h5>
                </div>
                <div class="card-body" id="recentTrades">
                    <div class="recent-trade d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-success">Îß§Ïàò</span>
                            <span class="ms-2">0.015 BTC</span>
                        </div>
                        <small>5Î∂Ñ Ï†Ñ</small>
                    </div>
                    <div class="recent-trade d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-danger">Îß§ÎèÑ</span>
                            <span class="ms-2">0.01 BTC</span>
                        </div>
                        <small>25Î∂Ñ Ï†Ñ</small>
                    </div>
                    <div class="recent-trade d-flex justify-content-between align-items-center">
                        <div>
                            <span class="badge bg-success">Îß§Ïàò</span>
                            <span class="ms-2">0.01 BTC</span>
                        </div>
                        <small>1ÏãúÍ∞Ñ Ï†Ñ</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- TradingView ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>

<script>
    let tradingViewWidget = null;
    let overlayVisible = true;
    
    // ÏûêÎèôÎß§Îß§ Ìè¨ÏßÄÏÖò Îç∞Ïù¥ÌÑ∞
    let tradingData = {
        longPosition: {
            size: 0.05,
            avgPrice: 117000,
            pnl: 85000
        },
        shortPosition: {
            size: 0.05,
            avgPrice: 119500,
            pnl: -42500
        },
        trades: [
            { time: '2025-07-23 14:30:00', type: 'buy', price: 116800, amount: 0.01 },
            { time: '2025-07-23 15:45:00', type: 'sell', price: 119200, amount: 0.01 },
            { time: '2025-07-23 16:15:00', type: 'buy', price: 117500, amount: 0.015 }
        ]
    };
    
    // TradingView ÏúÑÏ†Ø Ï¥àÍ∏∞Ìôî
    function initTradingView(symbol = "BYBIT:BTCUSDT") {
        const container = document.getElementById('tradingview_chart');
        if (!container) {
            console.error('TradingView Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            return;
        }
        
        container.innerHTML = '';
        
        if (typeof TradingView !== 'undefined') {
            tradingViewWidget = new TradingView.widget({
                width: "100%",
                height: 600,
                symbol: symbol,
                interval: "15",
                timezone: "Asia/Seoul",
                theme: "dark",
                style: "1",
                locale: "kr",
                toolbar_bg: "#1e1e1e",
                enable_publishing: false,
                allow_symbol_change: true,
                container_id: "tradingview_chart",
                studies: [],
                hide_side_toolbar: false,
                disabled_features: [],
                details: false,
                hotlist: false,
                calendar: false,
                mobile_friendly: true,
                auto_scale: true,
                hide_volume: false
            });
            
            console.log('‚úÖ TradingView ÏúÑÏ†Ø Î°úÎìú ÏôÑÎ£å');
            
            // ÏúÑÏ†Ø Î°úÎìú ÌõÑ Ïò§Î≤ÑÎ†àÏù¥ ÌëúÏãú
            setTimeout(() => {
                updatePositionOverlay();
            }, 3000);
            
        } else {
            container.innerHTML = `
                <div class="d-flex justify-content-center align-items-center h-100 chart-placeholder">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h5 class="mt-3">TradingView Ï∞®Ìä∏ Î°úÎî© Ï§ë...</h5>
                        <p>Ïã§ÏãúÍ∞Ñ Ï∞®Ìä∏Î•º Î∂àÎü¨Ïò§Í≥† ÏûàÏäµÎãàÎã§</p>
                    </div>
                </div>
            `;
        }
    }
    
    // Ìè¨ÏßÄÏÖò Ïò§Î≤ÑÎ†àÏù¥ ÏóÖÎç∞Ïù¥Ìä∏
    function updatePositionOverlay() {
        if (!overlayVisible) return;
        
        const longLine = document.getElementById('longPositionLine');
        const shortLine = document.getElementById('shortPositionLine');
        
        if (tradingData.longPosition.size > 0) {
            longLine.style.display = 'block';
            longLine.querySelector('.position-label').textContent = 
                `üü¢ Long Avg: $${tradingData.longPosition.avgPrice.toLocaleString()}`;
        }
        
        if (tradingData.shortPosition.size > 0) {
            shortLine.style.display = 'block';
            shortLine.querySelector('.position-label').textContent = 
                `üî¥ Short Avg: $${tradingData.shortPosition.avgPrice.toLocaleString()}`;
        }
    }
    
    // Ïò§Î≤ÑÎ†àÏù¥ ÌÜ†Í∏Ä
    function toggleOverlay() {
        overlayVisible = !overlayVisible;
        const overlay = document.getElementById('chartOverlay');
        const button = document.getElementById('toggleOverlay');
        
        if (overlayVisible) {
            overlay.style.display = 'block';
            button.innerHTML = '<i class="bi bi-eye-slash"></i> Ìè¨ÏßÄÏÖò Ïà®ÍπÄ';
            updatePositionOverlay();
        } else {
            overlay.style.display = 'none';
            button.innerHTML = '<i class="bi bi-eye"></i> Ìè¨ÏßÄÏÖò ÌëúÏãú';
        }
    }
    
    // Ìà¥ÌåÅ ÌëúÏãú
    function showTooltip(element) {
        const tooltip = document.getElementById('tradeTooltip');
        const tooltipText = element.getAttribute('data-tooltip');
        
        tooltip.innerHTML = tooltipText.replace(/\n/g, '<br>');
        tooltip.style.display = 'block';
        
        const rect = element.getBoundingClientRect();
        const containerRect = element.closest('.chart-container').getBoundingClientRect();
        
        tooltip.style.left = (rect.left - containerRect.left + 25) + 'px';
        tooltip.style.top = (rect.top - containerRect.top - 10) + 'px';
    }
    
    // Ìà¥ÌåÅ Ïà®ÍπÄ
    function hideTooltip() {
        const tooltip = document.getElementById('tradeTooltip');
        tooltip.style.display = 'none';
    }
    
    // Ïã¨Î≥º Î≥ÄÍ≤Ω
    function changeSymbol() {
        const selectElement = document.getElementById('chartSymbol');
        const selectedSymbol = selectElement.value;
        initTradingView(selectedSymbol);
    }
    
    // ÌòÑÏû¨ ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
    function updateTime() {
        const now = new Date();
        const timeString = now.toLocaleString('ko-KR', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        document.getElementById('currentTime').textContent = timeString;
    }
    
    // Ï†úÏñ¥ Î≤ÑÌäº Ìï®ÏàòÎì§
    function startTrading() {
        document.getElementById('systemStatus').textContent = 'Ïã§ÌñâÏ§ë';
        document.getElementById('systemStatus').className = 'text-success';
        alert('ÏûêÎèôÎß§Îß§Î•º ÏãúÏûëÌï©ÎãàÎã§.');
    }
    
    function stopTrading() {
        document.getElementById('systemStatus').textContent = 'Ï§ëÏßÄÎê®';
        document.getElementById('systemStatus').className = 'text-danger';
        alert('ÏûêÎèôÎß§Îß§Î•º Ï§ëÎã®Ìï©ÎãàÎã§.');
    }
    
    function trainAI() {
        document.getElementById('aiStatus').textContent = 'ÌïôÏäµÏ§ë';
        document.getElementById('aiStatus').className = 'badge bg-info';
        alert('AI ÌïôÏäµÏùÑ ÏãúÏûëÌï©ÎãàÎã§.');
        
        setTimeout(() => {
            document.getElementById('aiStatus').textContent = 'ÏôÑÎ£å';
            document.getElementById('aiStatus').className = 'badge bg-success';
        }, 3000);
    }
    
    function emergencyStop() {
        if (confirm('Î™®Îì† Ìè¨ÏßÄÏÖòÏùÑ Ï≤≠ÏÇ∞ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
            alert('Í∏¥Í∏â Ï≤≠ÏÇ∞ÏùÑ Ïã§ÌñâÌï©ÎãàÎã§.');
            tradingData.longPosition.size = 0;
            tradingData.shortPosition.size = 0;
            updatePositionOverlay();
        }
    }
    
    // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ ÎåÄÏãúÎ≥¥Îìú Î°úÎìú ÏôÑÎ£å');
        
        // ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ ÏãúÏûë
        updateTime();
        setInterval(updateTime, 1000);
        
        // TradingView ÏúÑÏ†Ø Ï¥àÍ∏∞Ìôî
        setTimeout(() => {
            initTradingView();
        }, 1000);
        
        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïï†ÎãàÎ©îÏù¥ÏÖò
        const cards = document.querySelectorAll('.status-card, .main-card');
        cards.forEach((card, index) => {
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });
    
    // TradingView ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú ÌôïÏù∏
    window.addEventListener('load', function() {
        const checkTradingView = setInterval(() => {
            if (typeof TradingView !== 'undefined') {
                clearInterval(checkTradingView);
                console.log('‚úÖ TradingView ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú ÏôÑÎ£å');
            }
        }, 100);
        
        setTimeout(() => {
            clearInterval(checkTradingView);
            if (typeof TradingView === 'undefined') {
                const container = document.getElementById('tradingview_chart');
                if (container) {
                    container.innerHTML = `
                        <div class="d-flex justify-content-center align-items-center h-100 chart-placeholder">
                            <div class="text-center">
                                <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                                <h5 class="mt-3">Ï∞®Ìä∏ Î°úÎî© Ïã§Ìå®</h5>
                                <p>Ïù∏ÌÑ∞ÎÑ∑ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî</p>
                                <button class="btn btn-outline-primary btn-sm" onclick="location.reload()">Îã§Ïãú ÏãúÎèÑ</button>
                            </div>
                        </div>
                    `;
                }
            }
        }, 10000);
    });
</script>
{% endblock %}